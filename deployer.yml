---
- name: Configure Deployer
  hosts: manager1
  become: true
  remote_user: ubuntu

  tasks:

  # - name: Add license Manager
  #   command: "/opt/splunk/bin/splunk edit licenser-localpeer -manager_uri https://splunkmgr1.aws.maximumpigs.com:8089 -auth admin:Administrator1!"

  - name: Set Deployment Server
    command: "/opt/splunk/bin/splunk set deploy-poll https://splunkmgr1.aws.maximumpigs.com:8089 -auth admin:Administrator1!"

## TODO - Modify deployment server with repositoryLocation = SPLUNK_HOME/etc/manager-apps and serverRepositoryLocationPolicy = rejectAlways

## TODO - Change this because CLI doesn't work. SED server.conf
  - name: Configure the deployer for SH Clustering
    command: "/opt/splunk/bin/splunk edit shcluster-config -secret shcluster1 -shcluster_label shcluster1 -auth admin:Administrator1!"

  - name: Restart Splunk
    command: "/opt/splunk/bin/splunk restart"